<!DOCTYPE html>
<html lang="ko">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1" />
  <title>ì˜ë‚¨ê³  ë‹¨ì–´ì¥ (Prodigy ~ Came out to)</title>
  <style>
    body { font-family: 'Pretendard', -apple-system, BlinkMacSystemFont, system-ui, Roboto, sans-serif; padding: 12px; background-color: #f9f9f9; }
    h2 { text-align: center; margin: 15px 0 20px; color: #333; }
    
    #controls { text-align: center; margin-bottom: 15px; }
    #btn-reverse {
      background-color: #007bff; color: white; border: none; padding: 10px 20px;
      border-radius: 6px; font-size: 1rem; cursor: pointer; transition: background 0.2s;
    }
    #btn-reverse:hover { background-color: #0056b3; }

    #counters { font-weight: bold; margin-bottom: 15px; text-align:center; font-size: 1.1em; }
    
    .table-wrapper { overflow-x: auto; box-shadow: 0 2px 8px rgba(0,0,0,0.1); border-radius: 8px; background: white; }
    table { width: 100%; border-collapse: collapse; font-size: 0.95em; }
    
    th, td { border-bottom: 1px solid #eee; padding: 12px 10px; text-align: left; vertical-align: middle; }
    th { background: #f1f3f5; color: #495057; font-weight: bold; border-top: 2px solid #dee2e6; }
    tr:last-child td { border-bottom: none; }
    
    /* ê°€ë¦¬ê¸° íš¨ê³¼ */
    .conceal { 
      color: transparent; 
      text-shadow: 0 0 8px rgba(0,0,0,0.5); 
      background-color: #e9ecef; 
      border-radius: 4px;
      cursor: pointer; 
      user-select: none;
    }
    
    /* ìƒíƒœ í‘œì‹œ */
    .unknown td { background-color: #fff5f5; }
    .unknown .col-eng, .unknown .col-mean { color: #e03131 !important; font-weight: bold; }
    .known td { background-color: #f8f9fa; color: #adb5bd; }
    
    /* ë²„íŠ¼ ìŠ¤íƒ€ì¼ */
    button { cursor: pointer; border: 1px solid #ced4da; background: white; border-radius: 4px; }
    .speak { 
      font-size: 1.2em; border: none; background: none; 
      cursor: pointer; padding: 0 0 0 5px; vertical-align: middle;
    }
    .col-act { white-space: nowrap; width: 120px; text-align: center; }
    .btn-known { margin-right: 5px; color: #2b8a3e; border-color: #2b8a3e; padding: 4px 8px; }
    .btn-known:hover { background: #2b8a3e; color: white; }
    .btn-unknown { color: #c92a2a; border-color: #c92a2a; padding: 4px 8px; }
    .btn-unknown:hover { background: #c92a2a; color: white; }

  </style>
</head>
<body>
  <h2>ì˜ë‚¨ê³  ë‹¨ì–´ì¥ (Prodigy ~ Came out to)</h2>

  <div id="controls">
    <button id="btn-reverse" type="button">ğŸ”„ ë‹¨ì–´/ëœ» ë’¤ì§‘ê¸°</button>
  </div>

  <div id="counters">ì•”ê¸°: 0 | ë¯¸ì•”ê¸°: 0</div>

  <div class="table-wrapper">
    <table>
      <thead>
        <tr>
          <th style="width: 40%">ì˜ì–´</th>
          <th style="width: 40%">ëœ»</th>
          <th>ìƒíƒœ</th>
        </tr>
      </thead>
      <tbody id="word-body"></tbody>
    </table>
  </div>

  <script>
    // ìš”ì²­í•˜ì‹  ìƒˆë¡œìš´ ë‹¨ì–´ ë¦¬ìŠ¤íŠ¸ë§Œ í¬í•¨
    const WORDS = [
      { eng: "prodigy", mean: "ì˜ì¬" },
      { eng: "the number of", mean: "~ì˜ ìˆ˜" },
      { eng: "a number of", mean: "ë‹¤ìˆ˜ì˜, ë§ì€" },
      { eng: "be admitted to", mean: "~ì— ì…í•™í•˜ë‹¤" },
      { eng: "make a/an (ì§ì—…)", mean: "(ì§ì—…)ì„ ê°–ë‹¤." },
      { eng: "manually", mean: "ìˆ˜ë™ìœ¼ë¡œ" },
      { eng: "segregation", mean: "ì¸ì¢… ì°¨ë³„" },
      { eng: "be reassigned to", mean: "~ì— ì¬ë°°ì¹˜ ë°›ë‹¤" },
      { eng: "permission", mean: "í—ˆë½" },
      { eng: "pay off", mean: "ê²°ì‹¤ì„ ë§ºë‹¤" },
      { eng: "credit", mean: "ì¸ì •" },
      { eng: "trajectory", mean: "ê¶¤ì " },
      { eng: "figure", mean: "ìˆ˜ì¹˜" },
      { eng: "dedicate A to B", mean: "Aë¥¼ Bì— ë°”ì¹˜ë‹¤" },
      { eng: "champion", mean: "ì˜¹í˜¸í•˜ë‹¤, ì§€ì§€í•˜ë‹¤" },
      { eng: "legacy", mean: "ìœ ì‚°" },
      { eng: "expectation", mean: "ê¸°ëŒ€" },
      { eng: "facility", mean: "ì‹œì„¤" },
      { eng: "boundary", mean: "ë²”ìœ„" },
      { eng: "prepare you for this career", mean: "ë„¤ê°€ ì´ ì§ì—…ì„ ì¤€ë¹„í•  ìˆ˜ ìˆê²Œ í•´ì£¼ë‹¤" },
      { eng: "stroke", mean: "ì“°ë‹¤ë“¬ë‹¤" },
      { eng: "came to", mean: "~í•˜ê²Œ ë˜ë‹¤" },
      { eng: "take a liking to", mean: "~ì´ ë§ˆìŒì— ë“¤ë‹¤" },
      { eng: "prestigious", mean: "ëª…ë§ ë†’ì€" },
      { eng: "side effects", mean: "ë¶€ì‘ìš©" },
      { eng: "portrait", mean: "ì´ˆìƒí™”" },
      { eng: "questionnaire", mean: "ì„¤ë¬¸ì§€" },
      { eng: "suspend(ed)", mean: "ë§¤ë‹¬ë‹¤ (ë§¤ë‹¬ë¦°)" },
      { eng: "appearance", mean: "ì™¸í˜• ì™¸ëª¨" },
      { eng: "to oneâ€™s surprise", mean: "ë†€ëê²Œë„" },
      { eng: "be afraid of", mean: "ë‘ë ¤ì›Œí•˜ë‹¤" },
      { eng: "barn", mean: "í—›ê°„" },
      { eng: "desperately", mean: "ì ˆì‹¤íˆ" },
      { eng: "sink", mean: "ê°€ë¼ì•‰ë‹¤" },
      { eng: "gratitude", mean: "ê°ì‚¬" },
      { eng: "vanish", mean: "ì‚¬ë¼ì§€ë‹¤" },
      { eng: "nightly", mean: "ë°¤ì˜(í˜•ìš©ì‚¬)" },
      { eng: "take a turn for the better/worse", mean: "ì¢‹ì•„ì§€ë‹¤/ë‚˜ë¹ ì§€ë‹¤" },
      { eng: "go by", mean: "(ì‹œê°„/ê³„ì ˆ ë“±ì´) í˜ëŸ¬ê°€ë‹¤" },
      { eng: "be observant", mean: "ì£¼ì˜ ê¹Šê²Œ ê´€ì°°í•˜ë‹¤" },
      { eng: "As it turned out", mean: "ì•Œê³ ë³´ë‹ˆ" },
      { eng: "is already well on her way to", mean: "~ì„ ì˜ í•˜ê³  ìˆë‹¤" },
      { eng: "superficially", mean: "ê²‰ë³´ê¸°ì—, í”¼ìƒì ìœ¼ë¡œ" },
      { eng: "continue her", mean: "ê·¸ë…€ë¥¼ ì´ì–´ê°€ë‹¤" },
      { eng: "chance", mean: "ê°€ëŠ¥ì„±" },
      { eng: "transfer", mean: "ì›€ì§ì´ë‹¤" },
      { eng: "drives and desires", mean: "ì¶©ë™ê³¼ ìš•êµ¬" },
      { eng: "came out to V", mean: "ë‚˜ì™€ì„œ Ví•˜ë‹¤" }
    ];

    let knownCount = 0;
    let unknownCount = 0;
    let reversed = false;
    let voices = [];

    // --- ìŒì„± ì¸ì‹(TTS) ë¡œì§ ---
    function loadVoices() {
      voices = window.speechSynthesis.getVoices();
    }
    
    if (window.speechSynthesis.onvoiceschanged !== undefined) {
      window.speechSynthesis.onvoiceschanged = loadVoices;
    }
    loadVoices();

    function speak(text) {
      window.speechSynthesis.cancel(); // ì¤‘ë³µ ì¬ìƒ ë°©ì§€

      // í…ìŠ¤íŠ¸ ì •ì œ ë¡œì§:
      // 1. ê´„í˜¸ ì•ˆì˜ ë‚´ìš© (ì§ì—…) ë“± ì œê±° -> replace(/\(.*\)/g, '')
      // 2. ìŠ¬ë˜ì‹œ(/)ë‚˜ íŠ¹ìˆ˜ë¬¸ì ì œê±° í›„ ê³µë°± ì²˜ë¦¬ -> replace(/[^a-zA-Z\sâ€™'-]/g, ' ')
      // ì˜ˆ: "make a/an (ì§ì—…)" -> "make a an" ìœ¼ë¡œ ë°œìŒ
      const cleanText = text
        .replace(/\(.*\)/g, '') 
        .replace(/\//g, ' ') 
        .replace(/[^a-zA-Z\sâ€™'-]/g, ' ')
        .trim();

      const u = new SpeechSynthesisUtterance(cleanText);
      u.lang = 'en-US';
      u.rate = 0.9; 

      if (voices.length > 0) {
        // Google US English ë˜ëŠ” ì¼ë°˜ US English ìš°ì„  ì„ íƒ
        const preferredVoice = voices.find(v => 
          (v.name.includes('Google') && v.lang.includes('en-US')) || 
          v.lang === 'en-US' || 
          v.lang.startsWith('en')
        );
        if (preferredVoice) {
          u.voice = preferredVoice;
        }
      }

      window.speechSynthesis.speak(u);
    }
    // ----------------------------

    function escapeHtml(s) {
      return String(s).replace(/[&<>"']/g, m => (
        { '&': '&amp;', '<': '&lt;', '>': '&gt;', '"': '&quot;', "'": '&#39;' }[m]
      ));
    }

    function updateCounters() {
      document.getElementById('counters').textContent = `ì•”ê¸°: ${knownCount} | ë¯¸ì•”ê¸°: ${unknownCount}`;
    }

    function setEnglishCellContent(td, text) {
      // í…ìŠ¤íŠ¸ì™€ ìŠ¤í”¼ì»¤ ë²„íŠ¼ ë°°ì¹˜
      td.innerHTML = `<span>${escapeHtml(text)}</span> <button class="speak" aria-label="ë“£ê¸°">ğŸ”Š</button>`;
      const btn = td.querySelector('.speak');
      btn.onclick = (e) => {
        e.stopPropagation();
        speak(text);
      };
    }

    function buildTable() {
      const tb = document.getElementById('word-body');
      tb.innerHTML = '';
      
      WORDS.forEach((item) => {
        const tr = document.createElement('tr');
        
        // ì˜ì–´ ì…€
        const tdEng = document.createElement('td');
        tdEng.className = 'col-eng';
        tdEng.dataset.original = item.eng;
        setEnglishCellContent(tdEng, item.eng);
        
        // ëœ» ì…€
        const tdMean = document.createElement('td');
        tdMean.className = 'col-mean';
        tdMean.dataset.meaning = item.mean;
        tdMean.textContent = item.mean;
        
        // ë²„íŠ¼ ì…€
        const tdAct = document.createElement('td');
        tdAct.className = 'col-act';
        tdAct.innerHTML = `<button class="btn-known">ì•”ê¸°</button><button class="btn-unknown">ë¯¸ì•”ê¸°</button>`;
        
        tr.append(tdEng, tdMean, tdAct);
        tb.appendChild(tr);
      });
      
      knownCount = 0; unknownCount = 0; updateCounters(); applyConceal();
    }

    function mark(btn, type) {
      const row = btn.closest('tr');
      const tb  = row.parentNode;
      
      if (type === 'known') {
        if (!row.classList.contains('known')) {
          knownCount++;
          if (row.classList.contains('unknown')) unknownCount--;
          row.classList.add('known');
          row.classList.remove('unknown');
        }
      } else if (type === 'unknown') {
        if (!row.classList.contains('unknown')) {
          unknownCount++;
          if (row.classList.contains('known')) knownCount--;
          row.classList.add('unknown');
          row.classList.remove('known');
          tb.insertBefore(row, tb.firstChild);
        }
      }
      updateCounters();
    }

    function applyConceal() {
      document.querySelectorAll('#word-body tr').forEach(r => {
        const eng = r.querySelector('.col-eng');
        const mean = r.querySelector('.col-mean');
        if(!eng || !mean) return;

        // ì´ˆê¸°í™”
        eng.classList.remove('conceal');
        mean.classList.remove('conceal');
        
        // ë‚´ìš© ë³µêµ¬ (ìŠ¤í”¼ì»¤ ë²„íŠ¼ í¬í•¨)
        if(!eng.querySelector('button')) setEnglishCellContent(eng, eng.dataset.original);
        mean.textContent = mean.dataset.meaning;

        // ê°€ë¦¬ê¸° ì ìš©
        const target = reversed ? eng : mean;
        target.textContent = 'í´ë¦­í•´ ë³´ê¸°';
        target.classList.add('conceal');
      });
    }

    function handleConcealClick(td) {
      if (!td.classList.contains('conceal')) {
        // ì´ë¯¸ ë³´ì´ëŠ” ìƒíƒœë©´ ë‹¤ì‹œ ê°€ë¦¬ê¸° (í† ê¸€)
        const row = td.closest('tr');
        const eng = row.querySelector('.col-eng');
        const mean = row.querySelector('.col-mean');
        
        const target = reversed ? eng : mean;
        if (td === target) {
          td.textContent = 'í´ë¦­í•´ ë³´ê¸°';
          td.classList.add('conceal');
        }
        return;
      }

      // ê°€ë ¤ì§„ ìƒíƒœ -> ë³´ì—¬ì£¼ê¸°
      if (td.classList.contains('col-eng')) {
        setEnglishCellContent(td, td.dataset.original);
      } else {
        td.textContent = td.dataset.meaning;
      }
      td.classList.remove('conceal');
    }

    function reverseCols() {
      reversed = !reversed;
      const ths = document.querySelectorAll('thead th');
      if (reversed) {
        ths[0].textContent = "ëœ»";
        ths[1].textContent = "ì˜ì–´";
      } else {
        ths[0].textContent = "ì˜ì–´";
        ths[1].textContent = "ëœ»";
      }
      
      document.querySelectorAll('#word-body tr').forEach(r => {
        const cells = Array.from(r.children);
        if (cells.length < 3) return;
        r.append(cells[1], cells[0], cells[2]);
      });
      applyConceal();
    }

    // ì´ë²¤íŠ¸ ë¦¬ìŠ¤ë„ˆ ì„¤ì •
    document.addEventListener('click', (e) => {
      if (e.target.matches('.btn-known')) {
        mark(e.target, 'known');
        return;
      }
      if (e.target.matches('.btn-unknown')) {
        mark(e.target, 'unknown');
        return;
      }
      const td = e.target.closest('td');
      if (td && (td.classList.contains('col-eng') || td.classList.contains('col-mean'))) {
        handleConcealClick(td);
      }
    });

    document.getElementById('btn-reverse').addEventListener('click', reverseCols);

    buildTable();
  </script>
</body>
</html>